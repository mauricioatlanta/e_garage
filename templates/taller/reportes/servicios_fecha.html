{% extends 'base.html' %}
{% load humanize %}

{% block extra_head %}
<style>
    :root {
        --cyber-blue: #00d4ff;
        --matrix-green: #39ff14;
        --neon-purple: #b347d9;
        --dark-bg: #0a0a0f;
        --glow-cyan: #00ffff;
    }

    body {
        background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 50%, #16213e 100%);
        color: var(--glow-cyan);
        font-family: 'Orbitron', 'Courier New', monospace;
    }

    .cyber-header {
        background: linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(179, 71, 217, 0.1) 100%);
        border: 1px solid var(--cyber-blue);
        border-radius: 15px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 0 30px rgba(0, 212, 255, 0.3);
    }

    .cyber-title {
        font-size: 2.5rem;
        font-weight: bold;
        text-align: center;
        background: linear-gradient(45deg, var(--matrix-green), var(--cyber-blue), var(--neon-purple));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 0.5rem;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .stat-card {
        background: rgba(10, 10, 15, 0.8);
        border: 1px solid var(--matrix-green);
        border-radius: 15px;
        padding: 1.5rem;
        text-align: center;
        box-shadow: 0 0 20px rgba(57, 255, 20, 0.2);
    }

    .stat-icon {
        font-size: 2.5rem;
        margin-bottom: 1rem;
    }

    .stat-value {
        font-size: 1.8rem;
        font-weight: bold;
        color: var(--cyber-blue);
        margin-bottom: 0.5rem;
    }

    .stat-label {
        color: var(--matrix-green);
        font-weight: bold;
        text-transform: uppercase;
        font-size: 0.9rem;
    }

    .cyber-table {
        width: 100%;
        border-collapse: collapse;
        background: rgba(10, 10, 15, 0.9);
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 0 30px rgba(179, 71, 217, 0.3);
    }

    .cyber-table th {
        background: linear-gradient(45deg, var(--matrix-green), var(--cyber-blue));
        color: #000;
        padding: 15px;
        text-align: left;
        font-weight: bold;
        text-transform: uppercase;
    }

    .cyber-table td {
        padding: 15px;
        border-bottom: 1px solid rgba(0, 212, 255, 0.3);
        color: var(--glow-cyan);
    }

    .cyber-table tr:hover {
        background: rgba(57, 255, 20, 0.1);
    }

    .btn-back {
        background: linear-gradient(45deg, var(--neon-purple), var(--cyber-blue));
        border: none;
        border-radius: 10px;
        color: #fff;
        padding: 12px 24px;
        text-decoration: none;
        font-weight: bold;
        display: inline-block;
        margin-bottom: 2rem;
        transition: all 0.3s ease;
    }

    .btn-back:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(179, 71, 217, 0.5);
    }

    .categoria-tag {
        background: rgba(57, 255, 20, 0.2);
        border: 1px solid var(--matrix-green);
        border-radius: 20px;
        padding: 5px 12px;
        font-size: 0.8rem;
        color: var(--matrix-green);
        font-weight: bold;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <a href="{% url 'reportes:reportes_por_fecha' %}?desde={{ desde }}&hasta={{ hasta }}" class="btn-back">
        ‚Üê Volver a Reportes por Fecha
    </a>

    <div class="cyber-header">
        <h1 class="cyber-title">üîß Reporte de Servicios</h1>
        <p style="text-align: center; color: var(--glow-cyan); opacity: 0.8;">
            An√°lisis de servicios del {{ desde }} al {{ hasta }}
        </p>
    </div>

    <!-- Estad√≠sticas Generales -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">üîß</div>
            <div class="stat-value">{{ servicios.count }}</div>
            <div class="stat-label">Total Servicios</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">‚è±Ô∏è</div>
            <div class="stat-value">{{ total_horas|floatformat:1|default:0 }}</div>
            <div class="stat-label">Horas Trabajadas</div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon">üí∞</div>
            <div class="stat-value">${{ total_servicios.valor_total|floatformat:0|default:0 }}</div>
            <div class="stat-label">Valor Total</div>
        </div>
    </div>

    <!-- Servicios por Categor√≠a -->
    {% if servicios_por_categoria %}
    <div style="background: rgba(10, 10, 15, 0.9); border: 1px solid var(--neon-purple); border-radius: 15px; padding: 2rem; margin-bottom: 2rem;">
        <h3 style="color: var(--neon-purple); margin-bottom: 1.5rem;">üìä Servicios por Categor√≠a</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
            {% for categoria in servicios_por_categoria %}
            <div style="background: rgba(0, 212, 255, 0.1); border: 1px solid var(--cyber-blue); border-radius: 10px; padding: 1rem;">
                <div style="font-weight: bold; color: var(--cyber-blue);">{{ categoria.categoria__nombre|default:"Sin categor√≠a" }}</div>
                <div style="margin-top: 0.5rem;">
                    <span style="color: var(--glow-cyan);">Servicios: {{ categoria.total_servicios }}</span> |
                    <span style="color: var(--matrix-green);">${{ categoria.valor_total|floatformat:0 }}</span>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Top Servicios -->
    {% if top_servicios %}
    <div style="background: rgba(10, 10, 15, 0.9); border: 1px solid var(--neon-purple); border-radius: 15px; padding: 2rem; margin-bottom: 2rem;">
        <h3 style="color: var(--neon-purple); margin-bottom: 1.5rem;">üèÜ Top 10 Servicios M√°s Solicitados</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
            {% for servicio in top_servicios %}
            <div style="background: rgba(57, 255, 20, 0.1); border: 1px solid var(--matrix-green); border-radius: 10px; padding: 1rem;">
                <div style="font-weight: bold; color: var(--cyber-blue);">{{ servicio.nombre }}</div>
                <div style="margin-top: 0.5rem;">
                    <span class="categoria-tag">{{ servicio.categoria__nombre|default:"Sin categor√≠a" }}</span>
                </div>
                <div style="margin-top: 0.5rem;">
                    <span style="color: var(--glow-cyan);">Veces: {{ servicio.total_veces }}</span> |
                    <span style="color: var(--cyber-blue);">${{ servicio.valor_total|floatformat:0 }}</span>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Tabla Detallada -->
    <div style="background: rgba(10, 10, 15, 0.9); border: 1px solid var(--cyber-blue); border-radius: 15px; padding: 2rem;">
        <h3 style="color: var(--cyber-blue); margin-bottom: 1.5rem;">üìã Detalle de Servicios</h3>
        
        {% if servicios %}
        <table class="cyber-table">
            <thead>
                <tr>
                    <th>üìÑ Documento</th>
                    <th>üìÖ Fecha</th>
                    <th>üîß Servicio</th>
                    <th>üìù Categor√≠a</th>
                    <th>‚è±Ô∏è Horas</th>
                    <th>üí∞ Precio</th>
                    <th>üíµ Total</th>
                </tr>
            </thead>
            <tbody>
                {% for servicio in servicios %}
                <tr>
                    <td>{{ servicio.documento.numero_documento|default:"Sin n√∫mero" }}</td>
                    <td>{{ servicio.documento.fecha|date:"d/m/Y" }}</td>
                    <td style="color: var(--matrix-green); font-weight: bold;">{{ servicio.nombre }}</td>
                    <td>
                        {% if servicio.categoria %}
                        <span class="categoria-tag">{{ servicio.categoria.nombre }}</span>
                        {% else %}
                        <span style="color: #666;">Sin categor√≠a</span>
                        {% endif %}
                    </td>
                    <td style="text-align: center;">{{ servicio.horas|default:"-" }}</td>
                    <td style="color: var(--cyber-blue);">${{ servicio.precio|floatformat:0 }}</td>
                    <td style="color: var(--matrix-green); font-weight: bold;">${{ servicio.total|floatformat:0 }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div style="text-align: center; padding: 3rem; color: var(--glow-cyan);">
            <div style="font-size: 3rem; margin-bottom: 1rem;">üîß</div>
            <h3>No se encontraron servicios</h3>
            <p>No hay servicios registrados en el per√≠odo seleccionado</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
